<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MAIN</title>

    <link rel="stylesheet" href="./assets/scss/main.css?v=1.1" />
    <link rel="stylesheet" href="./assets/scss/loading.css?v=1.1" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
  </head>

  <body>
    <audio
      id="bg-music"
      src="./assets/music/BG_music.mp3"
      preload="auto"
      loop
    ></audio>

    <a
      href="./index.html"
      class="intro-link-btn"
      aria-label="인트로 페이지로 이동"
    >
      <img
        src="./assets/images/ui/IntroReplayBtn.png"
        alt="인트로 아이콘"
        draggable="false"
      />
    </a>

    <main class="main-page">
      <div class="bg-animation" aria-hidden="true">
        <div id="stars"></div>
        <div id="stars2"></div>
        <div id="stars3"></div>
        <div id="stars4"></div>
      </div>

      <div class="hanja-layer" aria-hidden="true">
        <div class="hanja hanja-1">
          <img
            id="hanja1"
            class="hanja-img"
            src="./assets/images/hanja/hanja-yanquechutang.webp"
            alt="연작처당"
            draggable="false"
          />
        </div>

        <img
          class="hanja hanja-2 flicker"
          src="./assets/images/hanja/hanja-qianchezhijian.webp"
          alt="전거지감"
          draggable="false"
        />

        <img
          class="hanja hanja-3 blur-reveal"
          src="./assets/images/hanja/hanja-wangyangzhitan.webp"
          alt="망양지탄"
          draggable="false"
        />

        <img
          class="hanja hanja-4 pop"
          src="./assets/images/hanja/hanja-youbeiwuhuan.webp"
          alt="유비무환"
          draggable="false"
        />
      </div>

      <section class="chapter-buttons">
        <button
          class="chapter-btn btn-mu btn-glitch"
          data-link="./chapters/chapter1/intro/chapter1_intro.html"
        >
          무시
        </button>

        <button
          class="chapter-btn btn-gyeong btn-glitch"
          data-link="./chapters/chapter2/intro/chapter2_intro.html"
          data-loading="true"
        >
          경고
        </button>

        <button
          class="chapter-btn btn-hoo btn-glitch"
          data-link="./chapters/chapter3/chapter3_main.html"
        >
          후회
        </button>

        <button
          class="chapter-btn btn-seong btn-glitch"
          data-link="./chapters/chapter4/index.html"
        >
          성찰
        </button>
      </section>
    </main>

    <button
      id="infoBtn"
      class="info-trigger info-pos-tr"
      aria-haspopup="dialog"
      aria-expanded="false"
      style="
        font-family: 'JSongmyeong', 'Noto Sans KR', sans-serif !important;
        font-size: 30px !important;
      "
    >
      프로젝트 소개
    </button>

    <div id="infoOverlay" class="info-overlay" hidden></div>

    <aside
      id="infoPanel"
      class="info-panel"
      role="dialog"
      aria-modal="true"
      aria-labelledby="infoTitle"
      hidden
    >
      <header class="info-header">
        <button id="infoBack" class="info-back" aria-label="뒤로 가기">
          ←
        </button>
        <h2 id="infoTitle">Before the Disaster</h2>
        <span class="header-gap" aria-hidden="true"></span>
      </header>

      <section class="info-body">
        <blockquote class="lead">
          “사고는 갑자기 일어나지 않는다. 무시된 전조증상이 쌓여 재난이 된다.”
        </blockquote>
        <figure class="info-image2">
          <img src="./assets/images/BG/popupIMG2.png" alt="이미지 설명" />
        </figure>
        <figure class="info-image">
          <img src="./assets/images/BG/popupIMG.png" alt="설명" />
          <figcaption>
            사소해 보였던 징후, 익숙해서 무심히 지나친 경고들이 어떻게 참사로
            이어졌는지를<br />
            직접 경험해보며, 위험을 인지하고 대응하는 문화의 필요성을
            환기합니다. <br />
            기억만으로는 변화를 만들 수 없습니다. 작은 위험에도 귀 기울이는
            태도가 반복을 멈추는 시작입니다.
            <br />
            <br />

            <span style="color: #ba4e4e; font-size: 16px">
              웹사이트 일부 이미지는 AI를 활용하여 생성하였음을 명시합니다.
              <br />
              *사용 도구 - Midjourney, Skybox
            </span>
          </figcaption>
        </figure>
      </section>
    </aside>
    <div id="page-loading" aria-hidden="true" hidden>
      <div class="box" role="dialog" aria-label="로딩 안내">
        <div class="spinner" aria-hidden="true"></div>
        <div class="label" role="status">헤드셋 착용을 권장합니다...</div>
      </div>
    </div>

    <script src="./js/main.js" defer></script>
    <script src="./js/loading.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const bgMusic = document.getElementById('bg-music');

        // 사용자의 첫 클릭을 감지하여 음악 재생
        document.body.addEventListener(
          'click',
          function () {
            bgMusic.play().catch((error) => {
              console.log('Autoplay was prevented.');
            });
          },
          { once: true }
        );

        // ✅ 추가된 부분: 음악이 끝났을 때 다시 재생
        bgMusic.addEventListener('ended', function () {
          bgMusic.currentTime = 0; // 음악 재생 위치를 처음으로 돌림
          bgMusic.play(); // 다시 재생
        });
      });
    </script>
  </body>
</html>
