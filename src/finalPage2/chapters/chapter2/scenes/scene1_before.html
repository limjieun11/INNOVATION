<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>scene1_before</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- libs -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.105.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/panolens@0.12.0/build/panolens.min.js"></script>

    <!-- styles -->
    <link rel="stylesheet" href="./scss/scene_common.css" />
    <link rel="stylesheet" href="./scss/easter-egg.css" />

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      .scene-page {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }
      #viewer {
        position: relative;
        width: 100%;
        height: 100%;
      } /* ✅ 위치 기준 */
    </style>
  </head>
  <body>
    <audio id="bgm1" src="./BGM/subway.mp3" loop preload="auto"></audio>
    <audio id="bgm2" src="./BGM/subway02.mp3" loop preload="auto"></audio>
    <main class="scene-page">
      <div id="viewer">
        <!-- ✅ 버튼을 viewer 내부로 이동, yaw/pitch 부여(도 단위) -->
        <button
          id="easter-egg"
          type="button"
          aria-label="비상 탈출"
          data-next="../exit/chapter2_exit.html"
          data-yaw="-81"
          data-pitch="-6"
        ></button>
      </div>

      <button id="next-button"></button>
    </main>

    <!-- scripts: 공통 → 이스터에그 순서 -->
    <script src="./js/scene_common.js"></script>
    <script src="./js/easter-egg.js" defer></script>

    <script>
      initPanorama(
        './images/panorama/scene1_before.webp',
        'scene1_after.html',
        true // 이스터에그 포함 여부
      );
      document.addEventListener('DOMContentLoaded', () => {
        const bgm1 = document.getElementById('bgm1');
        const bgm2 = document.getElementById('bgm2');

        // ✅ 음량 조절 코드 추가
        bgm1.volume = 0.3;
        bgm2.volume = 0.9;

        document.body.addEventListener(
          'click',
          () => {
            bgm1
              .play()
              .catch((e) => console.log('BGM 1 autoplay was prevented.'));
            bgm2
              .play()
              .catch((e) => console.log('BGM 2 autoplay was prevented.'));
          },
          { once: true }
        );
      });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const delayTime = 300000; // 5분 = 300,000 밀리초 3분 = 180,000 밀리초 1분 = 60,000 밀리초

        // main.html로 이동할 상대 경로 설정
        const targetPageURL = '../../../main.html';

        function redirectToMain() {
          console.log(`페이지가 5분 후 ${targetPageURL}로 이동합니다.`);

          setTimeout(function () {
            window.location.href = targetPageURL;
          }, delayTime);
        }

        redirectToMain();
      });
    </script>
  </body>
</html>
